class K2WebSocketsConnector{static get id(){return'k2-ws'}static get name(){return'K2 remote via WebSockets'}static get capabilities(){return[Remoddle.id]}constructor(){}connect(a,b){let c='ws://'+window.location.hostname+':8090/ctl';console.log('connecting '+c);let d=new WebSocket(c);d.onopen=()=>{let c=new K2WebSocketsPort(d);console.log('ok, powering on'),c.send('SEMICOL1;'),c.send('POWER1;'),c._playStream('/stream.wav'),setTimeout(()=>{c._startPowerOnTimer(1e4),this._bindCommands(a,c),b(c)},5e3)}}_bindCommands(a,b){a.bind(EventType.keyDit,this.constructor.id,()=>b.send('.;')),a.bind(EventType.keyDah,this.constructor.id,()=>b.send('-;')),a.bind(EventType.mode,this.constructor.id,(a)=>b.send('MD'+(a.value+1)+';')),a.bind(EventType.freq,this.constructor.id,(a)=>{let c=a.value,d='FA';d+='000',1e7>c&&(d+='0'),d+=c,b.send(d+';')}),a.bind(EventType.wpm,this.constructor.id,(a)=>b.send('KS0'+a.value+';')),a.bind(EventType.filter,this.constructor.id,(a)=>b.filter(a.value)),a.bind(EventType.preamp,this.constructor.id,(a)=>b.send('PA'+(a.value?'1':'0')+';')),a.bind(EventType.attn,this.constructor.id,(a)=>b.send('RA0'+(a.value?'1':'0')+';'))}}class K2WebSocketsPort{constructor(a){this._ws=a}_playStream(a){console.log('playing RX stream'),this._player=new WavPlayer,this._player.play(a)}_startPowerOnTimer(a){this._timer=setInterval(()=>this.send('POWER1;'),a)}filter(){this._player&&this._player.setFilter(tcvr.sidetoneFreq,event.value)}disconnect(){clearInterval(this._timer),this.send('POWER0;'),this._ws&&this._ws.close(),this._player&&this._player.stop()}send(a){this._ws&&this._ws.send(a)}}tcvrConnectors.register(new K2WebSocketsConnector);